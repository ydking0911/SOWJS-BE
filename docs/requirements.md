# 요구사항 명세 — SOWJS.KR

> SOWJS.KR 서비스의 기능 요구사항을 MVP와 확장 기능으로 구분하여 정의합니다.

---

## 🏁 MVP (Minimum Viable Product) — 핵심 기능

### 1. 소환사명 입력 시스템

#### 기능 설명
- 10명의 소환사명을 한 번에 입력받아 팀 구성을 시작하는 진입점

#### 세부 요구사항
- [ ] 소환사명 개별 입력 필드 (최소 2명 ~ 최대 10명)
- [ ] **디스코드/카톡방 복사 붙여넣기 인식**: 줄바꿈 또는 쉼표로 구분된 텍스트를 자동 파싱
- [ ] 소환사명 유효성 검사 (Riot API 조회 후 존재 여부 확인)
- [ ] 서버 선택 기능 (KR, NA, EUW 등)
- [ ] 입력 완료 후 데이터 로딩 상태 표시 (스피너/프로그레스바)

#### 입력 예시 (복붙 인식)
```
닉네임1
닉네임2, 닉네임3
닉네임4 닉네임5
```
→ 자동으로 5명 분리 인식

---

### 2. 포지션 설정

#### 기능 설명
- 각 유저의 주 라인(Primary)과 부 라인(Secondary)을 설정하여 팀 구성 시 라인 밸런스 보장

#### 세부 요구사항
- [ ] 5개 포지션 선택: TOP / JUNGLE / MID / ADC / SUPPORT
- [ ] 주 라인 1개 필수 선택
- [ ] 부 라인 1개 선택 (선택 사항, "상관없음" 옵션 포함)
- [ ] Riot API에서 자동으로 주 포지션 가져오기 (수동 수정 가능)
- [ ] 팀 구성 시 각 팀에 5개 포지션이 모두 채워지도록 강제

---

### 3. 히든 MMR 산출 엔진

#### 기능 설명
- Riot API 데이터를 기반으로 각 유저의 실질 기여도를 수치화

#### 데이터 수집 (Riot API)
| 데이터 항목 | API 엔드포인트 | 설명 |
|------------|---------------|------|
| 현재 티어/LP | `/lol/league/v4/entries/by-summoner/{id}` | 솔로랭크 기준 |
| 최근 매치 목록 | `/lol/match/v5/matches/by-puuid/{puuid}/ids` | 최근 20~50게임 |
| 매치 상세 데이터 | `/lol/match/v5/matches/{matchId}` | KDA, CS, 시야 등 |
| 챔피언 숙련도 | `/lol/champion-mastery/v4/champion-masteries/by-puuid/{puuid}` | 모스트 챔피언 |

#### 히든 MMR 산출 지표 및 가중치 (초안)
| 지표 | 가중치 | 설명 |
|------|--------|------|
| 현재 티어 | 30% | 솔로랭크 티어 → 수치 변환 (Iron=1 ~ Challenger=10) |
| 최근 승률 | 20% | 최근 20게임 승률 |
| KDA | 15% | (Kill + Assist) / Death |
| 분당 CS | 15% | CS per Minute (포지션별 보정) |
| 시야 점수 | 10% | Vision Score per Minute |
| 오브젝트 기여 | 10% | 드래곤/바론 참여율 |

> ⚠️ 가중치는 베타 테스트 후 실제 데이터 기반으로 조정 예정

#### 세부 요구사항
- [ ] 최근 20게임 기본, 최대 50게임까지 설정 가능
- [ ] 포지션별 CS 기준 보정 (정글러는 CS 기준 다름)
- [ ] 데이터 캐싱: 동일 소환사 재조회 시 1시간 캐시 활용
- [ ] 히든 MMR 점수 유저에게 표시 (투명성 확보)

---

### 4. 팀 밸런싱 알고리즘

#### 기능 설명
- 10명의 히든 MMR을 기반으로 두 팀의 예상 승률이 50:50에 가장 가깝도록 팀 구성

#### 알고리즘 설계
```
입력: 10명의 유저 (히든 MMR, 주/부 포지션)
목표: 두 팀(5v5)의 MMR 합산 차이 최소화 + 포지션 충돌 최소화

1. 포지션 제약 조건 설정
   - 각 팀에 TOP, JG, MID, ADC, SUP 1명씩 배치
   - 주 라인 우선 배치, 불가 시 부 라인으로 대체

2. 조합 탐색 (최적화)
   - 10명 중 5명 선택: C(10,5) = 252가지 조합
   - 포지션 제약 조건 필터링
   - MMR 합산 차이가 가장 작은 조합 선택

3. 결과 출력
   - 팀 A / 팀 B 구성 및 포지션
   - 예상 승률 (팀 A: 52% vs 팀 B: 48% 등)
   - 대안 팀 구성 2~3개 추가 제공
```

#### 세부 요구사항
- [ ] 팀 구성 결과를 1순위 ~ 3순위로 제공
- [ ] 각 팀 구성에 대한 예상 승률 표시
- [ ] "라인 스왑" 옵션: 특정 유저의 포지션 변경 시 재계산
- [ ] 결과 공유 기능 (링크 복사, 이미지 저장)

---

## 📋 부가 기능 — 전적 검색

### 5. 라이트 전적 검색

#### 기능 설명
- 소환사명으로 간단한 전적 정보를 조회하는 기능

#### 세부 요구사항
- [ ] 소환사 기본 정보: 레벨, 프로필 아이콘, 현재 티어
- [ ] 모스트 챔피언 3개: 챔피언명, 숙련도, 승률, KDA
- [ ] 최근 20게임 요약: 승/패, 사용 챔피언, KDA, CS
- [ ] 최근 게임 상세 보기 (클릭 시 확장)
- [ ] 랭크 그래프: LP 변화 추이 (선택 사항)

---

## 🔮 향후 확장 기능 (Post-MVP)

### 6. 메타 분석
- [ ] 현재 패치 버전의 1티어 챔피언 목록 (티어별 분류)
- [ ] 챔피언별 픽률, 밴률, 승률 통계
- [ ] 포지션별 추천 챔피언

### 7. 아이템/스킬 빌드 추천
- [ ] 챔피언별 승률 높은 아이템 트리
- [ ] 스킬 찍는 순서 (Q/W/E/R 레벨업 순서)
- [ ] 룬 세팅 추천

### 8. 내전 결과 분석 (프리미엄)
- [ ] 내전 후 "역캐리 지수" 분석 (가장 팀에 기여 못한 유저)
- [ ] "숨은 공신" 분석 (KDA 외 기여도 높은 유저)
- [ ] 게임별 타임라인 분석

### 9. 디스코드 봇 연동
- [ ] `/팀짜기 [소환사명1] [소환사명2] ...` 커맨드
- [ ] 디스코드 채널 내 팀 구성 결과 자동 출력
- [ ] 봇 초대 및 서버 설정 기능

---

## 🛠️ 기술 스택 (확정)

| 영역 | 기술 | 비고 |
|------|------|------|
| **Frontend** | Next.js 14+ (App Router) + TypeScript | SSR/SSG 혼합, SEO 최적화 |
| **Frontend UI** | Tailwind CSS + shadcn/ui | 빠른 스타일링, 커스터마이징 용이 |
| **Backend (BFF)** | Node.js + Fastify + TypeScript | Riot API 호출, 데이터 정제, 캐싱 레이어 |
| **AI/ML 엔진** | Python + FastAPI | 히든 MMR 산출, 팀 밸런싱 알고리즘 |
| **AI/ML 라이브러리** | scikit-learn / numpy / pandas | MMR 모델 학습 및 추론 |
| **Database** | PostgreSQL (AWS RDS) | 유저 데이터, 내전 기록 영구 저장 |
| **Cache** | Redis (AWS ElastiCache) | Riot API 응답 캐싱 (1시간), 세션 |
| **외부 API** | Riot Games API | 게임 데이터 수집 |
| **Infra** | AWS (EC2 × 3 인스턴스 분리) | 상세 내용은 [architecture.md](./architecture.md) 참조 |

---

## 📐 비기능 요구사항

| 항목 | 목표 |
|------|------|
| **응답 시간** | 팀 구성 결과 10초 이내 |
| **동시 접속** | 초기 100명 동시 접속 처리 |
| **가용성** | 99% 업타임 목표 |
| **모바일 지원** | 반응형 웹 디자인 |
| **API 호출 제한** | Riot API Rate Limit 준수 (캐싱으로 최소화) |

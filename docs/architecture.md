# ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ â€” SOWJS.KR

> í™•ì •ëœ ê¸°ìˆ  ìŠ¤íƒ ê¸°ë°˜ì˜ AWS ì¸í”„ë¼ ë° ì„œë¹„ìŠ¤ ê°„ í†µì‹  êµ¬ì¡°ë¥¼ ì •ì˜í•©ë‹ˆë‹¤.

---

## ğŸ—ï¸ ì „ì²´ ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        USERS (Browser)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚ HTTPS
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Vercel Edge Network                          â”‚
â”‚              Next.js Frontend + Global CDN + SSL                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                                         â”‚
          â–¼                                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  EC2 Instance 1 â”‚                        â”‚  EC2 Instance 2  â”‚
â”‚                 â”‚                        â”‚                  â”‚
â”‚  [BACKEND BFF]  â”‚                        â”‚  [AI/ML ENGINE]  â”‚
â”‚  Node.js        â”‚                        â”‚  Python          â”‚
â”‚  Fastify        â”‚                        â”‚  FastAPI         â”‚
â”‚  TypeScript     â”‚                        â”‚  scikit-learn    â”‚
â”‚  Port: 4000     â”‚                        â”‚  Port: 8000      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                                          â”‚
         â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
         â”‚         â”‚                    â”‚           â”‚
         â”‚         â–¼                    â–¼           â”‚
         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
         â”‚  â”‚  AWS RDS    â”‚    â”‚  AWS         â”‚    â”‚
         â”‚  â”‚ PostgreSQL  â”‚    â”‚  ElastiCache â”‚    â”‚
         â”‚  â”‚             â”‚    â”‚  (Redis)     â”‚    â”‚
         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
         â”‚                                         â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚
                    Internal HTTP (VPC)             â”‚
                                                   â–¼
                                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                         â”‚   Riot Games API â”‚
                                         â”‚   (External)     â”‚
                                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ–¥ï¸ ì¸ìŠ¤í„´ìŠ¤ë³„ ì—­í•  ìƒì„¸

### Frontend (Vercel)

| í•­ëª© | ë‚´ìš© |
|------|------|
| **í”Œë«í¼** | Vercel |
| **í”„ë ˆì„ì›Œí¬** | Next.js 14+ (App Router) |
| **ì–¸ì–´** | TypeScript |
| **UI** | Tailwind CSS + shadcn/ui |

**ì£¼ìš” ì—­í• **
- SSR: ì „ì  ê²€ìƒ‰ í˜ì´ì§€ (SEO ì¤‘ìš”)
- CSR: íŒ€ êµ¬ì„± ì…ë ¥/ê²°ê³¼ í˜ì´ì§€ (ì¸í„°ë™ì…˜ ì¤‘ì‹¬)
- Static: ë©”íƒ€ ë¶„ì„, ì±”í”¼ì–¸ ì •ë³´ (ë¹Œë“œ ì‹œ ìƒì„±)
- Backend BFF(Instance 1)ì™€ REST API í†µì‹ 
- Edge Networkë¥¼ í†µí•œ ê¸€ë¡œë²Œ CDN ë° SSL ìë™í™”

**í˜ì´ì§€ ë Œë”ë§ ì „ëµ**

| í˜ì´ì§€ | ì „ëµ | ì´ìœ  |
|--------|------|------|
| `/` ë©”ì¸ | SSG | ì •ì  ì½˜í…ì¸  |
| `/summoner/[name]` ì „ì  ê²€ìƒ‰ | SSR | SEO + ì‹¤ì‹œê°„ ë°ì´í„° |
| `/custom-game` íŒ€ êµ¬ì„± | CSR | ë³µì¡í•œ ì¸í„°ë™ì…˜ |
| `/meta` ë©”íƒ€ ë¶„ì„ | ISR (1ì‹œê°„) | íŒ¨ì¹˜ ì£¼ê¸° ë°˜ì˜ |

---

### Instance 1 â€” Backend BFF (Node.js + Fastify)

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ëŸ°íƒ€ì„** | Node.js 20 LTS |
| **í”„ë ˆì„ì›Œí¬** | Fastify |
| **ì–¸ì–´** | TypeScript |
| **í¬íŠ¸** | 4000 |
| **ì¶”ì²œ ì‚¬ì–‘** | t3.medium (ì´ˆê¸°) |

**ì£¼ìš” ì—­í• **
- Riot API í˜¸ì¶œ ë° Rate Limit ê´€ë¦¬
- Redis ìºì‹± ë ˆì´ì–´ (API ì‘ë‹µ 1ì‹œê°„ ìºì‹œ)
- AI ì—”ì§„(Instance 3)ê³¼ ë‚´ë¶€ HTTP í†µì‹ 
- JWT ê¸°ë°˜ ì¸ì¦/ì¸ê°€ (ì¶”í›„ ë¡œê·¸ì¸ ê¸°ëŠ¥ ì‹œ)
- PostgreSQL ë°ì´í„° CRUD

**API ì—”ë“œí¬ì¸íŠ¸ (ì´ˆì•ˆ)**

```
GET  /api/summoner/:name          â†’ ì†Œí™˜ì‚¬ ê¸°ë³¸ ì •ë³´
GET  /api/summoner/:name/matches  â†’ ìµœê·¼ ë§¤ì¹˜ ëª©ë¡
GET  /api/summoner/:name/stats    â†’ íˆë“  MMRìš© í†µê³„ ë°ì´í„°
POST /api/custom-game/balance     â†’ íŒ€ ë°¸ëŸ°ì‹± ìš”ì²­ (AI ì—”ì§„ í˜¸ì¶œ)
GET  /api/meta/champions          â†’ ë©”íƒ€ ì±”í”¼ì–¸ ì •ë³´
GET  /api/health                  â†’ í—¬ìŠ¤ì²´í¬
```

**Riot API Rate Limit ì „ëµ**
```
Development Key: 20 req/s, 100 req/2min
Production Key:  ìš”ì²­ í•„ìš” (Riot ì‹¬ì‚¬)

ì „ëµ:
1. Redis ìºì‹±ìœ¼ë¡œ ì¤‘ë³µ í˜¸ì¶œ ìµœì†Œí™”
2. ìš”ì²­ í(Queue)ë¡œ Rate Limit ì´ˆê³¼ ë°©ì§€
3. ìºì‹œ ë¯¸ìŠ¤ ì‹œì—ë§Œ ì‹¤ì œ API í˜¸ì¶œ
```

---

### Instance 2 â€” AI/ML Engine (Python + FastAPI)

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ëŸ°íƒ€ì„** | Python 3.11+ |
| **í”„ë ˆì„ì›Œí¬** | FastAPI |
| **ë¼ì´ë¸ŒëŸ¬ë¦¬** | scikit-learn, numpy, pandas |
| **í¬íŠ¸** | 8000 |
| **ì¶”ì²œ ì‚¬ì–‘** | t3.medium (ì´ˆê¸°) |

**ì£¼ìš” ì—­í• **
- ìœ ì € í†µê³„ ë°ì´í„° ìˆ˜ì‹  â†’ íˆë“  MMR ì‚°ì¶œ
- 10ëª… ìœ ì € ë°ì´í„° ìˆ˜ì‹  â†’ ìµœì  íŒ€ êµ¬ì„± ì•Œê³ ë¦¬ì¦˜ ì‹¤í–‰
- ë‚´ë¶€ VPC í†µì‹ ë§Œ í—ˆìš© (ì™¸ë¶€ ì§ì ‘ ì ‘ê·¼ ì°¨ë‹¨)

**API ì—”ë“œí¬ì¸íŠ¸**

```
POST /mmr/calculate       â†’ ë‹¨ì¼ ìœ ì € íˆë“  MMR ì‚°ì¶œ
POST /team/balance        â†’ 10ëª… íŒ€ ë°¸ëŸ°ì‹± ìµœì í™”
GET  /health              â†’ í—¬ìŠ¤ì²´í¬
```

**íŒ€ ë°¸ëŸ°ì‹± ì•Œê³ ë¦¬ì¦˜ íë¦„**
```python
# ì…ë ¥: 10ëª…ì˜ ìœ ì € ë°ì´í„° (MMR, í¬ì§€ì…˜)
# ì¶œë ¥: ìµœì  íŒ€ êµ¬ì„± Top 3

1. C(10,5) = 252ê°€ì§€ ì¡°í•© ìƒì„±
2. í¬ì§€ì…˜ ì œì•½ ì¡°ê±´ í•„í„°ë§
   - ê° íŒ€ì— TOP/JG/MID/ADC/SUP 1ëª…ì”©
   - ì£¼ ë¼ì¸ ìš°ì„ , ë¶€ ë¼ì¸ ì°¨ì„ 
3. ê° ì¡°í•©ì˜ MMR í•©ì‚° ì°¨ì´ ê³„ì‚°
4. ì°¨ì´ê°€ ê°€ì¥ ì‘ì€ Top 3 ì¡°í•© ë°˜í™˜
5. ì˜ˆìƒ ìŠ¹ë¥  ê³„ì‚° (MMR ì°¨ì´ â†’ ìŠ¹ë¥  ë³€í™˜)
```

---

## ğŸ—„ï¸ ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„ (ì´ˆì•ˆ)

### AWS RDS â€” PostgreSQL

```sql
-- ì†Œí™˜ì‚¬ ìºì‹œ í…Œì´ë¸”
CREATE TABLE summoners (
  id          UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  puuid       VARCHAR(100) UNIQUE NOT NULL,
  name        VARCHAR(50) NOT NULL,
  server      VARCHAR(10) NOT NULL,  -- KR, NA, EUW...
  tier        VARCHAR(20),
  rank        VARCHAR(5),
  lp          INTEGER,
  hidden_mmr  FLOAT,
  updated_at  TIMESTAMP DEFAULT NOW()
);

-- ë‚´ì „ ê¸°ë¡ í…Œì´ë¸”
CREATE TABLE custom_games (
  id          UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  created_at  TIMESTAMP DEFAULT NOW(),
  team_a      JSONB NOT NULL,  -- íŒ€ A êµ¬ì„±
  team_b      JSONB NOT NULL,  -- íŒ€ B êµ¬ì„±
  balance_score FLOAT,         -- ë°¸ëŸ°ìŠ¤ ì ìˆ˜ (ë‚®ì„ìˆ˜ë¡ ê· í˜•)
  share_token VARCHAR(20) UNIQUE  -- ê²°ê³¼ ê³µìœ ìš© í† í°
);
```

### AWS ElastiCache â€” Redis

```
Key íŒ¨í„´:
summoner:{puuid}:info       â†’ ì†Œí™˜ì‚¬ ê¸°ë³¸ ì •ë³´ (TTL: 1h)
summoner:{puuid}:matches    â†’ ìµœê·¼ ë§¤ì¹˜ ëª©ë¡ (TTL: 1h)
summoner:{puuid}:stats      â†’ í†µê³„ ë°ì´í„° (TTL: 1h)
meta:champions:{patch}      â†’ ë©”íƒ€ ì±”í”¼ì–¸ ì •ë³´ (TTL: 24h)
```

---

## ğŸ”’ ë³´ì•ˆ ì„¤ê³„

| í•­ëª© | ì „ëµ |
|------|------|
| **VPC** | 2ê°œ ì¸ìŠ¤í„´ìŠ¤ ë™ì¼ VPC ë‚´ ë°°ì¹˜, AI ì—”ì§„ì€ ë‚´ë¶€ í†µì‹ ë§Œ í—ˆìš© |
| **Security Group** | Backend: Vercel/Publicì—ì„œ 4000 í—ˆìš©, AI: Backendì—ì„œë§Œ 8000 í—ˆìš© |
| **Riot API Key** | í™˜ê²½ë³€ìˆ˜ë¡œ ê´€ë¦¬, ì½”ë“œì— í•˜ë“œì½”ë”© ê¸ˆì§€ |
| **HTTPS** | Vercel (Managed SSL), Backend (AWS ALB/Nginx SSL) |
| **Rate Limiting** | Fastify rate-limit í”ŒëŸ¬ê·¸ì¸ìœ¼ë¡œ API ë‚¨ìš© ë°©ì§€ |

---

### ì´ˆê¸° (MVP)
```
Vercel (Free/Pro)  â†’ Frontend (Next.js)
EC2 t3.medium Ã— 1  â†’ Backend BFF (Node.js)
EC2 t3.medium Ã— 1  â†’ AI Engine (Python)
RDS db.t3.micro    â†’ PostgreSQL
ElastiCache t3.micro â†’ Redis
```

### ì„±ì¥ê¸° (íŠ¸ë˜í”½ ì¦ê°€ ì‹œ)
```
Vercel Enterprise  â†’ í”„ë¡ íŠ¸ì—”ë“œ í™•ì¥
Auto Scaling Group â†’ Backend, AI Engine ìˆ˜í‰ í™•ì¥
RDS Read Replica   â†’ ì½ê¸° ë¶€í•˜ ë¶„ì‚°
```

---

## ğŸ”„ ì„œë¹„ìŠ¤ ê°„ í†µì‹  íë¦„

### íŒ€ êµ¬ì„± ìš”ì²­ íë¦„

```
1. ìœ ì €ê°€ 10ëª… ì†Œí™˜ì‚¬ëª… ì…ë ¥ (Frontend)
2. Frontend â†’ Backend BFF: POST /api/custom-game/balance
3. Backend BFF â†’ Redis: ê° ì†Œí™˜ì‚¬ ìºì‹œ í™•ì¸
4. ìºì‹œ ë¯¸ìŠ¤ â†’ Backend BFF â†’ Riot API: ë§¤ì¹˜ ë°ì´í„° ìˆ˜ì§‘
5. Backend BFF â†’ AI Engine: POST /team/balance (í†µê³„ ë°ì´í„° ì „ì†¡)
6. AI Engine: íˆë“  MMR ì‚°ì¶œ + íŒ€ ë°¸ëŸ°ì‹± ì•Œê³ ë¦¬ì¦˜ ì‹¤í–‰
7. AI Engine â†’ Backend BFF: íŒ€ êµ¬ì„± ê²°ê³¼ ë°˜í™˜
8. Backend BFF â†’ PostgreSQL: ë‚´ì „ ê¸°ë¡ ì €ì¥
9. Backend BFF â†’ Frontend: ìµœì¢… ê²°ê³¼ ë°˜í™˜
10. Frontend: íŒ€ êµ¬ì„± ê²°ê³¼ ë Œë”ë§
```

### ì „ì  ê²€ìƒ‰ íë¦„

```
1. ìœ ì €ê°€ ì†Œí™˜ì‚¬ëª… ê²€ìƒ‰ (Frontend)
2. Next.js SSR: Backend BFFì— ë°ì´í„° ìš”ì²­
3. Backend BFF â†’ Redis: ìºì‹œ í™•ì¸
4. ìºì‹œ íˆíŠ¸ â†’ ì¦‰ì‹œ ë°˜í™˜ (ìºì‹œ ë¯¸ìŠ¤ â†’ Riot API í˜¸ì¶œ)
5. Frontend: ì „ì  ì •ë³´ ë Œë”ë§
```

---

## ğŸ—ï¸ ë°±ì—”ë“œ ìƒì„¸ ì•„í‚¤í…ì²˜ (Extended MVC)

SOWJS.KR ë°±ì—”ë“œëŠ” í™•ì¥ëœ **MVC(Model-View-Controller)** íŒ¨í„´ì„ ì‚¬ìš©í•©ë‹ˆë‹¤. ì½”ë“œì˜ ìœ ì§€ë³´ìˆ˜ì„±ê³¼ í™•ì¥ì„±ì„ ë†’ì´ê¸° ìœ„í•´ Controller ë ˆì´ì–´ì—ì„œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ë¶„ë¦¬í•œ **Service ë ˆì´ì–´**ë¥¼ ì¶”ê°€í•œ ê²ƒì´ íŠ¹ì§•ì…ë‹ˆë‹¤.

### ë ˆì´ì–´ë³„ ì—­í• 

| ë ˆì´ì–´ | ìœ„ì¹˜ | ì—­í•  |
| :--- | :--- | :--- |
| **Routes** | `src/routes/` | HTTP ê²½ë¡œ ì •ì˜ ë° Swagger ë¬¸ì„œ ìŠ¤í‚¤ë§ˆ ì„¤ì • |
| **Controllers** | `src/controllers/` | ìš”ì²­ íŒŒë¼ë¯¸í„° ì¶”ì¶œ, ì„œë¹„ìŠ¤ í˜¸ì¶œ ë° ì‘ë‹µ(JSON) ì œì–´ |
| **Services** | `src/services/` | **í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§** (MMR ê³„ì‚°, ì•Œê³ ë¦¬ì¦˜ ì œì–´, ì™¸ë¶€ API í˜¸ì¶œ íë¦„) |
| **Models** | `src/models/` | ë°ì´í„° ì „ì†¡ ê°ì²´(DTO) ì •ì˜ ë° ë‚´ë¶€ ë„ë©”ì¸ ì¸í„°í˜ì´ìŠ¤ |
| **Utils** | `src/utils/` | Riot API í´ë¼ì´ì–¸íŠ¸, Redis ìºì‹œ ë“± ê³µí†µ ìœ í‹¸ë¦¬í‹° |
| **Config** | `src/config/` | í™˜ê²½ ë³€ìˆ˜ ê´€ë¦¬ ë° ì¤‘ì•™ ì§‘ì¤‘ì‹ ì„¤ì • |

### ğŸ”„ ìš”ì²­ ì²˜ë¦¬ íë¦„ ë‹¤ì´ì–´ê·¸ë¨

```mermaid
sequenceDiagram
    participant User as User (Client)
    participant Route as Routes Layer
    participant Ctrl as Controller Layer
    participant Svc as Service Layer
    participant Model as Model Layer
    participant Ext as External (Riot API/AI Engine)
    participant Cache as Redis Cache

    User->>Route: API ìš”ì²­ (ì˜ˆ: GET /summoner/í˜ì´ì»¤)
    Route->>Ctrl: ìš”ì²­ ì „ë‹¬ (Validation í¬í•¨)
    Ctrl->>Svc: ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì‹¤í–‰ ìš”ì²­
    Svc->>Cache: ë°ì´í„° ìºì‹œ í™•ì¸
    
    alt ìºì‹œ ë¯¸ìŠ¤ (Cache Miss)
        Svc->>Ext: Riot API / AI Engine í˜¸ì¶œ
        Ext-->>Svc: ì›ì‹œ ë°ì´í„° ë°˜í™˜
        Svc->>Model: ë„ë©”ì¸ ëª¨ë¸ë¡œ ë³€í™˜ (Mapping)
        Model-->>Svc: ë³€í™˜ëœ ê°€ê³µ ë°ì´í„°
        Svc->>Cache: ê°€ê³µ ë°ì´í„° ì €ì¥
    else ìºì‹œ íˆíŠ¸ (Cache Hit)
        Cache-->>Svc: ì €ì¥ëœ ë°ì´í„° ë°˜í™˜
    end

    Svc-->>Ctrl: ìµœì¢… ë°ì´í„° ê²°ê³¼ ë°˜í™˜
    Ctrl-->>User: JSON ì‘ë‹µ ì „ì†¡ (Status Code í¬í•¨)
```

---

## ğŸ“Œ ê´€ë ¨ ë¬¸ì„œ

- [ì•„ì´ë””ì–´ ê°œìš”](./idea-overview.md)
- [ìš”êµ¬ì‚¬í•­ ëª…ì„¸](./requirements.md)
- [API ëª…ì„¸ì„œ](./api-spec.md)
- [Riot API ë ˆí¼ëŸ°ìŠ¤](./riot-api-reference.md)
